<!-- frontend/src/app/pago/cobranza/cobranza.component.html -->
 <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-6">
  
  <div class="flex flex-col gap-4">
    <mat-card>
      <mat-card-header><mat-card-title>Buscar Cliente</mat-card-title></mat-card-header>
      <mat-card-content class="mt-2">
        <mat-form-field class="w-full">
          <mat-label>Nombre o RFC</mat-label>
          <input type="text" matInput [formControl]="clienteControl" [matAutocomplete]="auto">
          <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayCli" (optionSelected)="seleccionarCliente($event.option.value)">
            <mat-option *ngFor="let c of clientesFiltrados$ | async" [value]="c">
              {{c.razonSocial}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </mat-card-content>
    </mat-card>

    <mat-card *ngIf="clienteSeleccionado">
      <mat-card-header><mat-card-title>Facturas con Saldo Pendiente</mat-card-title></mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="facturasPendientes" class="w-full">
          <ng-container matColumnDef="folio">
            <th mat-header-cell *matHeaderCellDef> Folio </th>
            <td mat-cell *matCellDef="let row"> {{row.serie}}{{row.folio}} </td>
          </ng-container>
          <ng-container matColumnDef="fecha">
            <th mat-header-cell *matHeaderCellDef> Fecha </th>
            <td mat-cell *matCellDef="let row"> {{row.fecha_emision | date:'shortDate'}} </td>
          </ng-container>
          <ng-container matColumnDef="total">
            <th mat-header-cell *matHeaderCellDef> Total </th>
            <td mat-cell *matCellDef="let row"> {{row.total | currency}} </td>
          </ng-container>
          <ng-container matColumnDef="saldo">
            <th mat-header-cell *matHeaderCellDef> Saldo </th>
            <td mat-cell *matCellDef="let row" class="text-red-600 font-bold"> {{row.saldo_pendiente | currency}} </td>
          </ng-container>
          <ng-container matColumnDef="abono">
            <th mat-header-cell *matHeaderCellDef> </th>
            <td mat-cell *matCellDef="let row">
               <button mat-icon-button color="accent" (click)="seleccionarFactura(row)">
                 <mat-icon>payments</mat-icon>
               </button>
            </td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell text-center p-4" colspan="5">Este cliente no tiene deudas.</td>
          </tr>
        </table>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="flex flex-col gap-4" *ngIf="facturaSeleccionada">
    <mat-card class="bg-green-50 border border-green-200">
      <mat-card-header>
        <mat-card-title>Registrar Abono</mat-card-title>
        <mat-card-subtitle>Factura {{facturaSeleccionada.serie}}{{facturaSeleccionada.folio}}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content class="flex flex-col gap-4 mt-4">
        
        <div class="text-xl text-center mb-2">
          Saldo Actual: <span class="font-bold text-red-600">{{facturaSeleccionada.saldo_pendiente | currency}}</span>
        </div>

        <mat-form-field class="w-full">
          <mat-label>Monto a Abonar</mat-label>
          <input matInput type="number" [(ngModel)]="montoAbono">
          <span matPrefix>$&nbsp;</span>
        </mat-form-field>

        <mat-form-field class="w-full">
          <mat-label>Forma de Pago</mat-label>
          <mat-select [(ngModel)]="formaPago">
            <mat-option value="Efectivo">Efectivo</mat-option>
            <mat-option value="Transferencia">Transferencia</mat-option>
            <mat-option value="Cheque">Cheque</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field class="w-full">
          <mat-label>Referencia (Opcional)</mat-label>
          <input matInput [(ngModel)]="referencia" placeholder="# OperaciÃ³n / Nota">
        </mat-form-field>

        <button mat-flat-button color="primary" class="py-6 text-lg" (click)="registrarPago()">
          <mat-icon>save</mat-icon> Aplicar Pago
        </button>

        <button mat-button color="warn" (click)="facturaSeleccionada = null">Cancelar</button>

      </mat-card-content>
    </mat-card>
  </div>

</div>