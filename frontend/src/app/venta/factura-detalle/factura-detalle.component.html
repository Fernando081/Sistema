<!-- frontend/src/app/venta/factura-detalle/factura-detalle.component.html -->
 <h2 mat-dialog-title>
  Detalle de Venta <span class="text-gray-500 text-base ml-2">Folio: {{data.serie}}{{data.folio}}</span>
</h2>

<mat-dialog-content class="mat-typography">
  
  <div class="mb-4 p-3 bg-gray-50 rounded border">
    <p class="font-bold text-sm">{{ data.nombre_receptor }}</p>
    <p class="text-xs text-gray-500">RFC: {{ data.rfc_receptor }}</p>
    <p class="text-xs text-gray-500">Fecha: {{ data.fecha_emision | date:'medium' }}</p>
  </div>

  <div class="overflow-auto max-h-60" *ngIf="!isLoading; else loading">
    <table mat-table [dataSource]="detalles" class="w-full">
      
      <ng-container matColumnDef="cant">
        <th mat-header-cell *matHeaderCellDef> Cant. </th>
        <td mat-cell *matCellDef="let element"> {{element.cantidad}} </td>
      </ng-container>

      <ng-container matColumnDef="unidad">
        <th mat-header-cell *matHeaderCellDef> Unidad </th>
        <td mat-cell *matCellDef="let element" class="text-xs text-gray-500"> {{element.unidad}} </td>
      </ng-container>

      <ng-container matColumnDef="desc">
        <th mat-header-cell *matHeaderCellDef> Descripci√≥n </th>
        <td mat-cell *matCellDef="let element"> 
          {{element.descripcion}}
          <div class="text-[10px] text-gray-400" *ngIf="element.importe_iva > 0">
            + IVA: {{element.importe_iva | currency}}
          </div>
          <div class="text-[10px] text-orange-300" *ngIf="element.importe_ret_isr > 0">
            - Ret. ISR: {{element.importe_ret_isr | currency}}
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="precio">
        <th mat-header-cell *matHeaderCellDef> P. Unit </th>
        <td mat-cell *matCellDef="let element"> {{element.precio_unitario | currency}} </td>
      </ng-container>

      <ng-container matColumnDef="importe">
        <th mat-header-cell *matHeaderCellDef> Importe </th>
        <td mat-cell *matCellDef="let element"> {{element.importe | currency}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>

  <ng-template #loading>
    <div class="p-4 text-center text-gray-500">Cargando detalles...</div>
  </ng-template>

  <div class="mt-4 border-t pt-2 text-right">
    <p class="text-lg font-bold">Total: {{ data.total | currency }}</p>
  </div>

</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cerrar()">Cerrar</button>
  <button mat-flat-button color="primary" (click)="imprimirTicket()">
    <mat-icon>print</mat-icon> Imprimir Factura
  </button> </mat-dialog-actions>